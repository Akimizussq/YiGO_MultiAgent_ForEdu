# Yigo-Edu-Agent: 基于 AutoGen 的教育场景多智能体仿真平台

本项目旨在探索使用 [Microsoft AutoGen](https://github.com/microsoft/autogen) 框架构建一个面向教育场景的多智能体（Multi-Agent）仿真平台。通过模拟不同的教学和讨论模式，为未来的教育应用提供原型和技术验证。

---

使用方法

1. 启动一个虚拟环境，并安装依赖：

    ```bash
    python -m venv .venv  # 创建虚拟环境

    .venv/Scripts/activate  # 激活虚拟环境

    pip install -r requirements.txt  # 安装依赖
    ```

2. 运行示例：
    - 中心化群聊模式：
        ```bash
        python test_manager_ver.py
        ```
    - 点对点对话模式：
        ```bash
        python test_p2p_ver.py
        ```

当前实现的效果



目前，项目包含以下几种核心的智能体交互模式实现。

---

## 供与参考的两个Autogen多智能体交互方式

### 1. 中心化群聊模式 (`test_manager_ver.py`)

该脚本演示了 AutoGen 最核心的 `GroupChatManager`（群聊管理器）模式。

- **架构**: 模拟一个有“主持人”的课堂讨论。所有智能体（老师、学生）都将发言内容发送给 `GroupChatManager`，由 `Manager` 来决定下一个发言者。
- **特点**:
    - **强控制**: `Manager` 确保了每次只有一个智能体发言，避免了混乱。
    - **全局上下文**: 所有对话都发生在同一个频道，所有智能体共享完整的聊天记录。
    - **可配置**: 可以通过 `system_message` 对 `Manager` 的行为进行指导，并通过 `max_round` 控制讨论长度。
- **适用场景**: 结构化的课堂讨论、头脑风暴、需要裁判或主持人的辩论会。

### 2. 点对点对话模式 (`test_p2p_ver.py`)

该脚本演示了两个智能体之间直接进行对话的模式。

- **架构**: 通过 `agent.initiate_chat(other_agent, ...)` 方法，一个智能体直接向另一个智能体发起对话，形成一个独立的“二人世界”。
- **特点**:
    - **直接高效**: 对话只在两个参与者之间进行，没有中间环节。
    - **私密性**: 对话内容不为第三方所知。
- **适用场景**: 一对一辅导、问答、任务委托等点对点交互。

---

## 当前实现的核心组件


### 1. 高级动态调度群聊模式 (`test_manager_ver.py` - 当前版本)

这是对中心化群聊模式的**重大升级**，是当前项目的核心成果，展示了通过继承和方法重写对 AutoGen 进行深度定制的能力。

- **架构**: 创建了一个自定义的 `EnhancedClassroomChat` 类，它继承自 `autogen.GroupChat`，并重写了核心的 `select_speaker` 方法，实现了一套高度定制化的课堂讨论调度引擎。
- **已达成的目标**:
    - **情景感知调度**: 能够识别老师话语中的“开始讨论”信号，自动切换到学生间的自由讨论模式。
    - **多维决策逻辑**: 综合运用了**点名检测**、**老师提问**、**学生间互动**、**发言沉默轮数**等多种规则，并结合**概率**来进行发言人选择，使得对话流转更加自然和动态。
    - **状态化管理**: 引入了“讨论模式”标记、轮数计数器、学生沉默计数器等状态，让管理器具备了上下文记忆，能够执行更长程的对话策略（如“讨论几轮后切回老师总结”）。
    - **异构智能体**: 通过精心设计的 `system_message`，塑造了性格和语言风格各异的“积极型”、“严谨型”、“批判型”学生，使讨论内容更具多样性和真实感。

---

## 与最终目标的差距与展望

参照 `仿真平台后端设计：基础平台与异构智能体.md` 中的计划，我们当前通过 `test_manager_ver.py` 的探索，主要在**对话与交互模块 (`dialogues`)** 和 **干预模块 (`interventions`)** 的部分核心逻辑上取得了显著进展。我们已经用代码原型验证了“行为层干预（发言时机调控）”和部分“社会层干预（角色分配）”的可行性。

然而，距离构建一个完整的、可部署的仿真平台，我们还有以下主要差距：

1.  **从脚本到服务 (API & `agents` 模块)**
    - **当前**: 所有逻辑都在一个 Python 脚本中运行。智能体是代码中定义的临时对象。
    - **目标**: 需要将智能体的定义（人格、记忆、知识状态）持久化，如设计文档中的 `Agent`、`AgentProfile` 模型。需要将交互逻辑封装成可被前端（如 Unity）调用的 API 服务（如 Django）。

2.  **从隐式状态到显式记忆 (`Memory` & `Knowledge` 模块)**
    - **当前**: 智能体的“记忆”仅限于当前对话的上下文窗口。`EnhancedClassroomChat` 中的状态（如沉默计数）是临时的。
    - **目标**: 需要为每个智能体构建独立的、持久化的长短期记忆模块和知识状态模块。智能体应能“记住”跨越多次对话的知识点，并形成自己的知识图谱（`KnowledgeState`）。

3.  **从规则驱动到数据驱动 (`analytics` & `Policy` 模块)**
    - **当前**: 发言人选择主要依赖于我们手动编写的规则 (`if-else` 逻辑)。
    - **目标**: 引入数据分析与评估模块 (`analytics`)，对讨论质量（如参与度、知识构建效率）进行量化评估。未来甚至可以基于这些评估数据，通过强化学习等方法自动优化 `Policy`，让管理器的调度策略自我进化。

4.  **从手动干预到自动干预 (`interventions` 模块)**
    - **当前**: 干预逻辑（如让老师总结）是硬编码在 `select_speaker` 方法中的。
    - **目标**: 建立一个独立的、可配置的干预规则库。系统可以根据实时分析的讨论数据（如“话题偏离度超过80%”），自动从库中选择并触发最合适的干预策略（如“知识线索提示”）。

---

## 下一步努力的方向

通过当前的探索，我们已经验证了多种通信模式的可行性。接下来的目标是构建更**动态、真实、可控**的多智能体协作系统。

1.  **实现混合通信模式 (Hybrid Communication)**
    - **目标**: 将群聊与点对点对话结合。例如，在群聊中，老师可以调用一个“私下辅导”函数，与某个学生开启一个临时的、私密的对话，辅导结束后再将结果带回群聊。
    - **技术路径**: 深入使用 AutoGen 的**函数调用 (Function Calling)** 功能，将一种对话模式作为另一种对话模式的“工具”。

2.  **构建更复杂的发言人选择策略**
    - **目标**: 让 `ClassroomManager` 的决策更加智能，模拟更真实的课堂动态。
    - **技术路径**:
        - **引入“发言意愿”**: 让每个智能体根据上下文“思考”自己是否想发言，`Manager` 在决策时将此作为重要依据。
        - **实现“对话记忆”**: 避免某个学生连续发言，或确保长时间未发言的学生有机会发言。
        - **上下文感知**: 更精准地识别发言中的意图，例如识别出“总结”、“提问”、“反驳”等，并据此选择下一个最合适的发言角色。

3.  **赋予智能体使用工具的能力 (Tool Use)**
    - **目标**: 让学生或老师智能体能够使用外部工具来辅助完成任务。
    - **技术路径**: 为智能体注册工具函数，例如：
        - `search_web(query)`: 学生可以上网查找资料来回答问题。
        - `run_python_code(code)`: 老师可以运行代码来验证一个物理公式。

4.  **探索智能体的状态与记忆**
    - **目标**: 让智能体拥有“个性”和“记忆”。一个学生在多次讨论后，应该能形成自己的知识体系和观点倾向。
    - **技术路径**: 为每个智能体附加一个状态管理器，用于记录其关键学习成果、情绪状态或性格参数，并在 `system_message` 中动态更新。

通过以上方向的努力，我们可以将这个项目从简单的对话模拟，逐步演进为一个能够真正仿真复杂教育场景、具备实际应用价值的强大平台。



## 更新项目记录
|备注|时间|
|---|---|
| 新增 `test_dynamic_manager.py`，演示了如何定制群聊管理器的发言人选择逻辑。 | 11/10 |
| 完善了 `test_p2p_ver.py`，添加了更详细的注释和示例。 | 11/10 |
| 优化了 `test_manager_ver.py`，增加了 `max_round` 参数，控制讨论轮数。 | 11/10 |
