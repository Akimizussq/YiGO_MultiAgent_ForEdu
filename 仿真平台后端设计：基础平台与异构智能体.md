ä¸€ä¸ª**é¢å‘æ•™è‚²åœºæ™¯çš„å¤šæ™ºèƒ½ä½“ä»¿çœŸå¹³å°**ã€‚å®ƒä¸»è¦æœ‰ä¸¤ä¸ªæ–¹å‘ï¼šä¸€æ˜¯**è®¨è®ºä»¿çœŸ**ï¼Œæ¨¡æ‹Ÿå­¦ç”Ÿç¾¤ä½“çš„è®¨è®ºäº’åŠ¨ï¼›äºŒæ˜¯**æ•™å­¦æˆè¯¾ä»¿çœŸ**ï¼Œä¸ºå¸ˆèŒƒç”Ÿæä¾›è™šæ‹Ÿæ•™å­¦ä¸è¯¾å ‚ç®¡ç†çš„è®­ç»ƒç¯å¢ƒã€‚

åç«¯æ‰“ç®—ç”¨ **Django** æ¥åšï¼Œå¹¶ä¸”é‡‡å–**é«˜è§£è€¦çš„å¤š app æ¶æ„**ï¼Œæ–¹ä¾¿åç»­æ‰©å±•å’ŒæŠ€æœ¯å‡çº§ã€‚
æ„å»ºï¼š
1. å¼‚æ„æ™ºèƒ½ä½“ï¼ˆä½¿ç”¨ä¸åŒçš„æ¨¡å‹ã€ä¸åŒçš„Promptã€ä¸åŒçš„çŸ¥è¯†åº“è®°å¿†ï¼‰
	1. æ¢ç©¶å¤šæ™ºèƒ½ä½“çš„å¼‚æ„æ€§æ€ä¹ˆå®ç°
	2. æ€ä¹ˆå®ç°æ™ºèƒ½ä½“å»ºæ¨¡
	3. æ¢ç©¶ä¸åŒçš„çŸ¥è¯†ç®¡ç†ç­–ç•¥ï¼ˆï¼ˆA-memé¡¹ç›®ï¼‰ï¼‰

### 1. agentsï¼ˆæ™ºèƒ½ä½“æ¨¡å—ï¼‰ç±»ä¼¼Promptæ¨¡å—ï¼Œé¢„è®¾å¤šæ¨¡æ¿

- åŠŸèƒ½ï¼šç®¡ç†ä¸åŒç±»å‹çš„æ™ºèƒ½ä½“ï¼ˆå­¦ç”Ÿã€æ•™å¸ˆã€åŠ©æ•™ã€AIå¯¼å¸ˆï¼‰ã€‚
```
Agent
 â”œâ”€â”€ Profileï¼ˆäººæ ¼ï¼‰
 â”‚     â””â”€â”€ Big Five + speaking style
 â”œâ”€â”€ Memoryï¼ˆè¯­ä¹‰ä¸æƒ…å¢ƒè®°å¿†ï¼‰
 â”œâ”€â”€ Policyï¼ˆå¼ºåŒ–å­¦ä¹  / è§„åˆ™ç­–ç•¥ï¼‰
 â””â”€â”€ Knowledge_Stateï¼ˆä»»åŠ¡çŸ¥è¯† / è®¤çŸ¥æ¨¡å‹ï¼‰
```

- `Agent`ï¼ˆåŸºç¡€ä¿¡æ¯ï¼šidã€ç±»å‹ã€ä¸ªæ€§å‚æ•°ã€çŠ¶æ€ï¼‰
```python
class Agent(models.Model):
    """
    æ™ºèƒ½ä½“åŸºç¡€æ¨¡å‹ï¼š
    å®šä¹‰ç³»ç»Ÿä¸­å„ç±»æ™ºèƒ½ä½“çš„æ ¸å¿ƒå±æ€§ä¸å†…éƒ¨ç»“æ„ã€‚
    """
    name = models.CharField(max_length=100, help_text="æ™ºèƒ½ä½“åç§°")
    role = models.CharField(max_length=100, help_text="æ™ºèƒ½ä½“ç±»å‹ï¼Œå¦‚ student/teacher/assistant/mentor")
	prompt_template = models.TextField()
    # å­æ¨¡å—å…³è”
    profile = models.OneToOneField("AgentProfile", on_delete=models.CASCADE, related_name="agent")
    state = models.OneToOneField("AgentState", on_delete=models.CASCADE, related_name="agent")

    # å†…éƒ¨æ•°æ®æ¨¡å—
    memory = models.JSONField(default=dict, help_text="è¯­ä¹‰è®°å¿†ä¸äº¤äº’å†å²")
    policy = models.JSONField(default=dict, help_text="ç­–ç•¥å‚æ•°æˆ–å¼ºåŒ–å­¦ä¹ æƒé‡")
    knowledge = models.JSONField(default=dict, help_text="çŸ¥è¯†æŒæ¡çŠ¶æ€æˆ–è¯­ä¹‰ç½‘ç»œ")

    def __str__(self):
        return f"{self.name} ({self.role})"

```

- `AgentProfile`ï¼ˆæ€§æ ¼ç‰¹å¾ã€äººæ ¼ç­‰å› ç´ ï¼‰ã€‚
```python
class AgentProfile(models.Model):
    """
    æ™ºèƒ½ä½“ä¸ªæ€§é…ç½®æ¨¡å‹ï¼š
    é‡‡ç”¨ Big Five äººæ ¼ç»´åº¦å»ºæ¨¡ï¼Œç”¨äºå¼‚è´¨æ€§ä»¿çœŸä¸è¯­è¨€é£æ ¼ç”Ÿæˆã€‚
    """
    openness = models.FloatField(default=0.5, help_text="å¼€æ”¾æ€§ï¼šåˆ›æ–°ã€æ±‚çŸ¥å€¾å‘")
    conscientiousness = models.FloatField(default=0.5, help_text="å°½è´£æ€§ï¼šè´£ä»»å¿ƒä¸è‡ªæˆ‘ç®¡ç†èƒ½åŠ›")
    extraversion = models.FloatField(default=0.5, help_text="å¤–å‘æ€§ï¼šç¤¾äº¤ä¸è¡¨è¾¾å€¾å‘")
    agreeableness = models.FloatField(default=0.5, help_text="å®œäººæ€§ï¼šåˆä½œä¸å…±æƒ…å€¾å‘")
    neuroticism = models.FloatField(default=0.5, help_text="ç¥ç»è´¨ï¼šæƒ…ç»ªç¨³å®šæ€§")
    speaking_style = models.CharField(max_length=50, default="neutral", help_text="è¯­è¨€é£æ ¼ï¼šæ­£å¼ã€å¹½é»˜ã€ä¸­æ€§ç­‰")

    def __str__(self):
        return f"Profile of {self.agent.name}"

```

- `AgentState`ï¼ˆå½“å‰çŠ¶æ€ï¼šä¸“æ³¨ã€èµ°ç¥ã€å‘è¨€ä¸­â€¦ï¼‰ã€‚
```python
class AgentState(models.Model): #æ™ºèƒ½ä½“å½“å‰çŠ¶æ€

Â Â Â  agent = models.OneToOneField(Agent, on_delete=models.CASCADE, related_name="state")

Â Â Â  attention = models.FloatField(default=1.0)Â Â Â Â  # ä¸“æ³¨ç¨‹åº¦

Â Â Â  emotion = models.CharField(max_length=50, default="neutral")

Â Â Â  is_speaking = models.BooleanField(default=False)

Â Â Â  current_task = models.CharField(max_length=200, blank=True, null=True)

Â Â Â  last_action = models.CharField(max_length=200, blank=True, null=True)

Â Â Â  timestamp = models.DateTimeField(auto_now=True)
```

- `Memory`
```python
class Memory(models.Model):
    agent = models.OneToOneField("Agent", on_delete=models.CASCADE, related_name="memory")

    short_term = models.JSONField(default=dict)   # è¿‘æœŸå¯¹è¯ä¸Šä¸‹æ–‡
    long_term = models.JSONField(default=dict)    # å†å²è¯­ä¹‰å­˜å‚¨ï¼ˆæ‘˜è¦æˆ–å‘é‡ç´¢å¼•ï¼‰
    working_memory = models.JSONField(default=dict)  # å½“å‰ä»»åŠ¡çŠ¶æ€
    
    last_updated = models.DateTimeField(auto_now=True)

    def update_short_term(self, new_message):
        """æ›´æ–°çŸ­æœŸè®°å¿†"""
        history = self.short_term.get("conversation_history", [])
        history.append(new_message)
        self.short_term["conversation_history"] = history[-10:]  # é™åˆ¶é•¿åº¦
        self.save()

    def summarize_to_long_term(self):
        """å‘¨æœŸæ€§å°†çŸ­æœŸè®°å¿†æ‘˜è¦è¿›é•¿æœŸè®°å¿†"""
        from some_embedding_module import summarize
        summary = summarize(self.short_term["conversation_history"])
        self.long_term.setdefault("summaries", []).append(summary)
        self.short_term["conversation_history"] = []  # æ¸…ç©ºçŸ­æœŸç¼“å­˜
        self.save()

```

- `Knowledge
```python
class KnowledgeState(models.Model):
    """
    æ™ºèƒ½ä½“çŸ¥è¯†çŠ¶æ€æ¨¡å—ï¼š
    ç”¨äºæè¿°ä»»åŠ¡ç›¸å…³çŸ¥è¯†ã€æŒæ¡ç¨‹åº¦ä¸è®¤çŸ¥æ›´æ–°è½¨è¿¹ã€‚
    """
    agent = models.OneToOneField("Agent", on_delete=models.CASCADE, related_name="knowledge")

    # æ¦‚å¿µæŒæ¡çŠ¶æ€
    concepts = models.JSONField(default=dict, help_text="çŸ¥è¯†ç‚¹çŠ¶æ€ï¼Œå¦‚ {'NewtonLaw': {'mastery':0.8, 'last_updated':'2025-10-11'}}")

    # ä»»åŠ¡è®¤çŸ¥æ¨¡å‹
    cognitive_model = models.JSONField(default=dict, help_text="è®¤çŸ¥ç½‘ç»œæˆ–ä»»åŠ¡è§„åˆ’æ¨¡å‹")

    # æ›´æ–°è®°å½•
    update_history = models.JSONField(default=list, help_text="çŸ¥è¯†æ›´æ–°å†å²è®°å½•")
    last_updated = models.DateTimeField(auto_now=True)

    def update_knowledge(self, concept, mastery_change):
        """
        æ›´æ–°æŒ‡å®šçŸ¥è¯†ç‚¹çš„æŒæ¡ç¨‹åº¦
        """
        if concept not in self.concepts:
            self.concepts[concept] = {"mastery": 0.0}
        self.concepts[concept]["mastery"] = max(0.0, min(1.0, self.concepts[concept]["mastery"] + mastery_change))
        self.save()

    def __str__(self):
        return f"Knowledge state of {self.agent.name}"

```

---

### 3. **dialoguesï¼ˆå¯¹è¯ä¸äº¤äº’æ¨¡å—ï¼‰**

- åŠŸèƒ½ï¼šç®¡ç†æ™ºèƒ½ä½“ä¹‹é—´çš„å¯¹è¯ï¼ˆè®¨è®ºã€å¸ˆç”Ÿé—®ç­”ï¼‰ã€‚æ–°è¯é¢˜äº§ç”Ÿçš„æ—¶é—´ç‚¹ï¼Ÿéšç€è®¨è®ºçš„è¿›è¡Œä¼šæœ‰æ–°è¯é¢˜çš„å‡ºç°
- `Dialogue`ï¼ˆä¼šè¯è½®æ¬¡ï¼ˆå®šæ—¶åœºæ™¯ï¼‰ã€å‚ä¸è€…ã€æ—¶é—´æˆ³ï¼‰
```python
class Dialogue(models.Model):

Â Â Â  title = models.CharField(max_length=200)Â  #ä¼šè¯æ ‡é¢˜

Â Â Â  participants = models.ManyToManyField('agents.Agent')

Â Â Â  start_time = models.DateTimeField(auto_now_add=True) #å¯¹è¯åˆ›å»ºæ—¶é—´

Â Â Â  round_count = models.IntegerField(default=0)Â  #ä¼šè¯ä¼¦æ¬¡ï¼Œç”¨äºè¯„ä¼°ä¸€ç¯çŸ¥è¯†ã€äºŒç¯çŸ¥è¯†
Â Â Â  topic = models.CharField(max_length=200, blank=True, null=True)Â  #å¯¹è¯ä¸»é¢˜
```

- `Utterance`ï¼ˆå‘è¨€å†…å®¹ã€è®¤çŸ¥æ°´å¹³æ ‡ç­¾ã€æƒ…æ„Ÿæ ‡ç­¾ï¼‰ã€‚
```python
class Utterance(models.Model):

Â Â Â  dialogue = models.ForeignKey('Dialogue', on_delete=models.CASCADE, related_name='utterances') #è¿™æ¡å‘è¨€å±äºå“ªä¸ªå¯¹è¯

Â Â  speaker=models.ForeignKey('agents.Agent',on_delete=models.CASCADE)

Â Â Â  content = models.TextField()Â  #å‘è¨€å†…å®¹

Â Â Â  cognitive_level = models.CharField(max_length=30, blank=True, null=True)Â  Â #è®¤çŸ¥æ°´å¹³æ ‡ç­¾
Â Â Â  emotion = models.CharField(max_length=30, blank=True, null=True)Â  # æƒ…æ„Ÿæ ‡ç­¾
Â Â Â  if_intervention = models.BooleanField(default=False)Â  # æ˜¯å¦ä¸ºå¹²é¢„
Â Â Â  timestamp = models.DateTimeField(auto_now_add=True) #å‘è¨€æ—¶é—´
```


---

### 4. **tasksï¼ˆä»»åŠ¡ä¸åœºæ™¯æ¨¡å—ï¼‰**

- åŠŸèƒ½ï¼šå®šä¹‰ä»¿çœŸåœºæ™¯ï¼ˆå°ç»„è®¨è®ºã€è¯¾å ‚æ•™å­¦ï¼‰å’Œå­¦ä¹ ä»»åŠ¡ã€‚
- `Task`ï¼ˆä»»åŠ¡æè¿°ï¼‰
```python
class Task(models.Model):  # å­¦ä¹ ä»»åŠ¡æ¨¡å‹
    title = models.CharField(max_length=100)
    description = models.TextField()
    difficulty = models.CharField(max_length=30, blank=True, null=True)
    goal = models.TextField(blank=True, null=True)
    created_at = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return self.title
```

- `Scenario`ï¼ˆåœºæ™¯é…ç½®ï¼Œå¦‚äººæ•°ã€æ—¶é—´é™åˆ¶ï¼‰
```python
class Scenario(models.Model):  # ä»¿çœŸåœºæ™¯æ¨¡å‹
    name = models.CharField(max_length=100)
    tasks = models.ManyToManyField("Task", related_name="scenarios")  # åœºæ™¯å¯åŒ…å«å¤šä¸ªä»»åŠ¡
    agents = models.ManyToManyField("Agent", related_name="scenarios")  # åœºæ™¯å‚ä¸çš„æ™ºèƒ½ä½“
    time_limit = models.IntegerField(blank=True, null=True)
    environment = models.CharField(max_length=100, blank=True, null=True)
    start_time = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return self.name
```
---

### 5. **interventionsï¼ˆå¹²é¢„ä¸åé¦ˆæ¨¡å—ï¼‰**

- åŠŸèƒ½ï¼šç®¡ç†æ•™å¸ˆæˆ– AI å¯¼å¸ˆçš„å¹²é¢„è¡Œä¸ºã€‚
- `Intervention`ï¼ˆå¹²é¢„ç±»å‹ï¼šæé—®ã€åé¦ˆã€æ€»ç»“ã€æç¤ºï¼‰ã€‚

| ç»´åº¦                      | ç±»å‹                         | ç¤ºä¾‹                        | é€‚ç”¨åœºæ™¯       |
| ----------------------- | -------------------------- | ------------------------- | ---------- |
| ğŸ¯ è®¤çŸ¥å±‚å¹²é¢„ï¼ˆCognitiveï¼‰     | çŸ¥è¯†çº¿ç´¢æç¤ºï¼ˆKnowledge Cueingï¼‰   | å‘ Agent æä¾›ä¸ä¸»é¢˜ç›¸å…³çš„å…³é”®è¯ã€æ¦‚å¿µç½‘ç»œ  | å­¦ç”Ÿè®¨è®ºåç¦»ä¸»é¢˜æ—¶  |
| ğŸ’¬ ç¤¾ä¼šå±‚å¹²é¢„ï¼ˆSocialï¼‰        | è§’è‰²å†åˆ†é…ï¼ˆRole Rebalancingï¼‰    | è°ƒæ•´å‘è¨€æ¯”ä¾‹ã€æŒ‡å®šæ€»ç»“è€…/æé—®è€…          | è®¨è®ºä¸­ä¸ªä½“å¤±è¡¡æ—¶   |
| âš™ï¸ å…ƒè®¤çŸ¥å¹²é¢„ï¼ˆMetacognitiveï¼‰ | åæ€æç¤ºï¼ˆReflection Promptï¼‰    | ç³»ç»Ÿç”Ÿæˆâ€œè¯·æ€»ç»“ç›®å‰è§‚ç‚¹ä¸€è‡´ä¸åˆ†æ­§â€        | çŸ¥è¯†å»ºæ„åœæ»æ—¶    |
| ğŸ§  æƒ…æ„Ÿå±‚å¹²é¢„ï¼ˆAffectiveï¼‰     | æƒ…ç»ªè°ƒèŠ‚ï¼ˆAffect Regulationï¼‰    | è¯†åˆ«ç„¦è™‘ã€æ— èŠç­‰çŠ¶æ€å¹¶æä¾›é¼“åŠ±/å¹½é»˜        | ç¾¤ä½“æƒ…ç»ªä½è½æ—¶    |
| ğŸ” è¡Œä¸ºå±‚å¹²é¢„ï¼ˆBehavioralï¼‰    | å‘è¨€æ—¶æœºè°ƒæ§ï¼ˆTurn Managementï¼‰    | æ§åˆ¶å‘è¨€é¢‘ç‡ã€è§¦å‘å†·å¯åŠ¨å‘è¨€            | å­˜åœ¨æ²‰é»˜æˆå‘˜æ—¶    |
| ğŸ§© æ™ºèƒ½ä½“å±‚å¹²é¢„ï¼ˆAgent-Levelï¼‰  | ç­–ç•¥æ›´æ–°ï¼ˆPolicy Updateï¼‰        | ä¿®æ”¹ agent çš„ reward å‡½æ•°æˆ–è®°å¿†ç­–ç•¥ | è¿›è¡Œè‡ªé€‚åº”å­¦ä¹ æ—¶   |
| ğŸ”„ ç³»ç»Ÿå±‚å¹²é¢„ï¼ˆSystem-Levelï¼‰  | ç¯å¢ƒå‚æ•°è°ƒæ•´ï¼ˆEnvironment Tuningï¼‰ | æ”¹å˜ä»»åŠ¡éš¾åº¦ã€ä¿¡æ¯é€æ˜åº¦ã€AI å‚ä¸æ¯”ä¾‹      | ç ”ç©¶è®¨è®ºåŠ¨æ€æ¼”åŒ–æœºåˆ¶ |
```python
class Intervention(models.Model):
    INTERVENTION_TYPES = [
        ('COG', 'Cognitive'),
        ('SOC', 'Social'),
        ('META', 'Metacognitive'),
        ('AFF', 'Affective'),
        ('BEH', 'Behavioral'),
        ('AGT', 'Agent-Level'),
        ('SYS', 'System-Level'),
    ]

    name = models.CharField(max_length=100)
    type = models.CharField(max_length=10, choices=INTERVENTION_TYPES)
    description = models.TextField(blank=True, null=True)
    trigger_condition = models.JSONField(default=dict)   # è§¦å‘æ¡ä»¶ï¼Œå¦‚{"silence_duration": 60, "topic_deviation": 0.8}
    action = models.JSONField(default=dict)               # å¹²é¢„åŠ¨ä½œï¼Œå¦‚{"agent_target": "all", "message": "è¯·æ€»ç»“å½“å‰è§‚ç‚¹"}

    def __str__(self):
        return f"{self.name} ({self.get_type_display()})"

```

- `InterventionLog`ï¼ˆå¹²é¢„æ—¶æœºã€æ•ˆæœï¼‰ã€‚
```python
class InterventionLog(models.Model):
    intervention = models.ForeignKey('Intervention', on_delete=models.CASCADE, related_name='logs')
    scenario = models.ForeignKey('Scenario', on_delete=models.CASCADE, related_name='intervention_logs')
    executed_at = models.DateTimeField(auto_now_add=True)  # æ‰§è¡Œæ—¶é—´
    target_agents = models.ManyToManyField('Agent', blank=True, related_name='intervention_logs')  # å®é™…å—å½±å“çš„Agent
    result = models.JSONField(blank=True, null=True)  # å¯è®°å½•å¹²é¢„æ•ˆæœæˆ–ç³»ç»Ÿåé¦ˆï¼Œå¦‚ {"engagement_increased": True}
    note = models.TextField(blank=True, null=True)    # å¤‡æ³¨æˆ–è°ƒè¯•ä¿¡æ¯

    def __str__(self):
        return f"Log of {self.intervention.name} at {self.executed_at}"

```
---

### 6. **analyticsï¼ˆæ•°æ®åˆ†æä¸è¯„ä¼°æ¨¡å—ï¼‰**

- åŠŸèƒ½ï¼šå¯¹è®¨è®ºè¿‡ç¨‹ã€äº¤äº’ç½‘ç»œã€çŸ¥è¯†æ‰©æ•£è¿›è¡Œåˆ†æã€‚
- æ¨¡å‹ï¼š
    - `Metric`ï¼ˆå‚ä¸åº¦ã€ä¸­å¿ƒåº¦ã€çŸ¥è¯†è¦†ç›–ç‡ï¼‰ã€‚
    - `Evaluation`ï¼ˆå­¦ä¹ æ•ˆæœè¯„ä¼°ã€ç¾¤ä½“æ•ˆèƒ½ï¼‰ã€‚

---

### 7. **logsï¼ˆæ—¥å¿—ä¸æ•°æ®å­˜å‚¨æ¨¡å—ï¼‰**

- åŠŸèƒ½ï¼šè®°å½•æ‰€æœ‰ä»¿çœŸæ•°æ®ï¼Œæ”¯æŒåç»­ç ”ç©¶ä¸å›æ”¾ã€‚
- æ¨¡å‹ï¼š
    - `SimulationLog`ï¼ˆå…¨å±€ä»¿çœŸæ—¥å¿—ï¼‰ã€‚
    - `EventLog`ï¼ˆæ—¶é—´æˆ³ã€äº‹ä»¶ã€å‚ä¸è€…ï¼‰ã€‚
- å¯æ‰©å±•ç‚¹ï¼š
    - æ—¥å¿—æ ¼å¼æ ‡å‡†åŒ–ï¼ˆJSONï¼‰ï¼Œæ”¯æŒå¯¼å‡ºåˆ°å¤–éƒ¨æ•°æ®åº“ã€‚
    - åç»­å¯ä½œä¸ºè®­ç»ƒæ•°æ®é›†ã€‚

---

### 8. **apiï¼ˆæ¥å£æ¨¡å—ï¼‰**

- åŠŸèƒ½ï¼šæä¾› REST API / GraphQL / WebSocket æ¥å£ç»™å‰ç«¯ï¼ˆUnityã€å¤§å±Webï¼‰ã€‚
- å¯æ‰©å±•ç‚¹ï¼š
    - æ”¯æŒå®æ—¶æµå¼å¯¹è¯ï¼ˆWebSocketï¼‰ã€‚
    - æ”¯æŒå¤–éƒ¨ AI æœåŠ¡å¯¹æ¥ï¼ˆOpenAIã€HuggingFaceï¼‰ã€‚

---
